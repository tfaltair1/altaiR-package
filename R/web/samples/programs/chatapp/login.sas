%MACRO testForUsername;
	%GLOBAL SAVE_username;
	%IF ~%SYMEXIST(userid) %THEN %DO;
		DATA _NULL_;
			FILE _WEBOUT;
			PUT "<html>";
			PUT "<body>";
			PUT "<form method=""POST"" action=""/wpscgi/broker.exe"">";
			PUT "  <input type=""hidden"" name=""_SERVICE"" value=""&_SERVICE"" />";
			PUT "  <input type=""hidden"" name=""_PROGRAM"" value=""ca.login.sas"" />";
			PUT "  <h4>Username:</h4>";
			PUT "  <input name=""userid"" value="""" size=""16""/>";
			PUT "  <input type=""submit"" name=""submit"" value=""Submit"" />";
			PUT "</form>";
			PUT "</body>";
			PUT "</html>";
		RUN;
	%END;
	%ELSE %DO;
		DATA _NULL_;
			rc = APPSRV_SESSION('create');
			CALL SYMPUT('SAVE_username', "&userid");
		RUN;

		DATA _NULL_;
			FILE _WEBOUT;
			PUT "<html>";
			PUT " <head>";
			PUT "  <meta http-equiv=""refresh"" content=""2;URL=&_THISSESSION" '&_program=ca.chatapp.sas' """ />";
			PUT " </head>";
			PUT "<body>";
			PUT "  <h1>Logon Successful</h1>";
			PUT "  <a href=""&_THISSESSION" '&_program=ca.chatapp.sas' """>Click here if your browser does not redirect</a>";
			PUT "</body>";
			PUT;
		RUN;
	%END;
%MEND;
%testForUsername;
